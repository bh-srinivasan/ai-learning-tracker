{% extends "base.html" %} {% block title %}Manage Courses - Admin Panel{%
endblock %} {% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2><i class="fas fa-graduation-cap"></i> Manage Courses</h2>
  <div>
    <button
      id="validate-urls-btn"
      class="btn btn-warning me-2"
      onclick="startUrlValidation()"
      style="color: white;"
    >
      <i class="fas fa-check-circle"></i> Validate All URLs
    </button>
    <a
      href="{{ url_for('admin_course_configs') }}"
      class="btn btn-success me-2"
    >
      <i class="fas fa-search"></i> Search & Import
    </a>
    <a href="{{ url_for('admin_add_course') }}" class="btn btn-primary me-2">
      <i class="fas fa-plus"></i> Add Course
    </a>
    <form
      method="POST"
      action="{{ url_for('admin_populate_linkedin_courses') }}"
      class="d-inline"
    >
      <button
        type="submit"
        class="btn btn-info"
        onclick="return confirm('Add LinkedIn Learning AI courses?')"
      >
        <i class="fab fa-linkedin"></i> Add LinkedIn Courses
      </button>
    </form>
  </div>
</div>

<!-- Quick Stats and Filters -->
<div class="row mb-4">
  <div class="col-md-12">
    <div class="card">
      <div class="card-body">
        <div class="row">
          <div class="col-md-4">
            <div class="stat-card text-center">
              <h5 class="text-primary">{{ courses|length }}</h5>
              <small class="text-muted">Total Courses</small>
            </div>
          </div>
          <div class="col-md-4">
            <div class="stat-card text-center">
              <h5 class="text-success">
                {{ courses|selectattr('source', 'equalto', 'LinkedIn
                Learning')|list|length }}
              </h5>
              <small class="text-muted">LinkedIn Learning</small>
            </div>
          </div>
          <div class="col-md-4">
            <div class="stat-card text-center">
              <h5 class="text-warning">
                {{ courses|selectattr('source', 'equalto', 'Manual')|list|length
                }}
              </h5>
              <small class="text-muted">Manual Entries</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="card">
  <div class="card-header">
    <div class="row align-items-center">
      <div class="col-md-6">
        <h5 class="mb-0"><i class="fas fa-list"></i> Course Catalog</h5>
      </div>
      <div class="col-md-6 text-end">
        <div class="btn-group" role="group">
          <button
            type="button"
            class="btn btn-outline-secondary btn-sm"
            onclick="exportData('csv')"
            title="Export filtered data to CSV"
          >
            <i class="fas fa-download"></i> Export CSV
          </button>
          <button
            type="button"
            class="btn btn-outline-secondary btn-sm"
            onclick="printTable()"
            title="Print current table view"
          >
            <i class="fas fa-print"></i> Print
          </button>
          <button
            type="button"
            class="btn btn-outline-info btn-sm"
            onclick="showTableStats()"
            title="Show detailed statistics"
          >
            <i class="fas fa-chart-bar"></i> Stats
          </button>
          <button
            type="button"
            class="btn btn-outline-secondary btn-sm"
            onclick="showHelp()"
            title="Show keyboard shortcuts and help"
          >
            <i class="fas fa-question-circle"></i> Help
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    {% if courses %}
    <!-- Advanced Filters -->
    <div class="row mb-3">
      <div class="col-md-3">
        <label for="sourceFilter" class="form-label">Filter by Source:</label>
        <select id="sourceFilter" class="form-select form-select-sm">
          <option value="">All Sources</option>
          {% set sources = courses|map(attribute='source')|unique|list %} {% for
          source in sources %}
          <option value="{{ source }}">{{ source }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2">
        <label for="levelFilter" class="form-label">Filter by Level:</label>
        <select id="levelFilter" class="form-select form-select-sm">
          <option value="">All Levels</option>
          <option value="Beginner">Beginner</option>
          <option value="Learner">Learner</option>
          <option value="Intermediate">Intermediate</option>
          <option value="Expert">Expert</option>
        </select>
      </div>
      <div class="col-md-2">
        <label for="urlStatusFilter" class="form-label"
          >Filter by URL Status:</label
        >
        <select id="urlStatusFilter" class="form-select form-select-sm">
          <option value="">All Status</option>
          <option value="Working">‚úÖ Working</option>
          <option value="Not Working">‚ùå Not Working</option>
          <option value="Broken">üîó Broken</option>
          <option value="unchecked">‚è∏Ô∏è Unchecked</option>
        </select>
      </div>
      <div class="col-md-2">
        <label for="pointsFilter" class="form-label">Filter by Points:</label>
        <select id="pointsFilter" class="form-select form-select-sm">
          <option value="">All Points</option>
          <option value="0-50">0-50 Points</option>
          <option value="51-100">51-100 Points</option>
          <option value="101+">101+ Points</option>
        </select>
      </div>
      <div class="col-md-3">
        <label for="searchFilter" class="form-label">Search:</label>
        <input
          type="text"
          id="searchFilter"
          class="form-control form-control-sm"
          placeholder="Search title or description..."
        />
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-3">
        <button
          type="button"
          class="btn btn-outline-danger btn-sm"
          onclick="clearFilters()"
        >
          <i class="fas fa-times"></i> Clear Filters
        </button>
      </div>
    </div>

    <div class="table-responsive">
      <div id="tableLoading" class="text-center py-4" style="display: none">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2 text-muted">Loading courses...</p>
      </div>
      <table
        id="coursesTable"
        class="table table-hover table-striped sortable-table"
      >
        <thead class="table-dark">
          <tr>
            <th class="sortable" data-column="0" data-type="text">Title</th>
            <th class="sortable" data-column="1" data-type="text">Source</th>
            <th class="sortable" data-column="2" data-type="level">Level</th>
            <th class="sortable" data-column="3" data-type="number">Points</th>
            <th class="sortable" data-column="4" data-type="text">
              Description
            </th>
            <th class="sortable" data-column="5" data-type="text">
              URL Status
            </th>
            <th class="sortable" data-column="6" data-type="date">Created</th>
            <th class="no-sort">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for course in courses %}
          <tr data-course-id="{{ course.id }}">
            <td>
              <div>
                <strong>{{ course.title }}</strong>
                <br />
                <small class="text-muted">
                  <a
                    href="{{ course.link or course.url or '#' }}"
                    target="_blank"
                    class="text-decoration-none"
                  >
                    <i class="fas fa-external-link-alt"></i> View Course
                  </a>
                </small>
              </div>
            </td>
            <td>
              <span
                class="badge bg-{% if course.source == 'LinkedIn Learning' %}primary{% elif course.source == 'Coursera' %}success{% elif course.source == 'Udemy' %}warning{% else %}secondary{% endif %}"
              >
                {{ course.source or 'Manual' }}
              </span>
            </td>
            <td>
              <span class="badge bg-secondary">
                {{ course.level or 'Beginner' }}
              </span>
            </td>
            <td>
              <span class="badge bg-light text-dark">
                {{ course.points or 0 }} pts
              </span>
            </td>
            <td>
              <div
                class="course-description"
                title="{{ course.description or 'No description' }}"
              >
                {{ course.description[:80] if course.description else 'No
                description' }} {% if course.description and
                course.description|length > 80 %}...{% endif %}
              </div>
            </td>
            <td>
              {% if course.url_status == 'Working' %}
              <span class="badge bg-success url-status">
                <i class="fas fa-check-circle"></i> Working
              </span>
              {% elif course.url_status == 'Not Working' %}
              <span class="badge bg-danger url-status">
                <i class="fas fa-times-circle"></i> Not Working
              </span>
              {% elif course.url_status == 'Broken' %}
              <span class="badge bg-warning url-status">
                <i class="fas fa-exclamation-triangle"></i> Broken
              </span>
              {% else %}
              <span class="badge bg-secondary url-status">
                <i class="fas fa-question-circle"></i> Unchecked
              </span>
              {% endif %} {% if course.last_url_check %}
              <div class="small text-muted mt-1">
                {{ course.last_url_check[:10] }}
              </div>
              {% endif %}
            </td>
            <td>
              <small class="text-muted"
                >{{ course.created_at[:10] if course.created_at else 'N/A'
                }}</small
              >
            </td>
            <td>
              <div class="btn-group" role="group">
                <a
                  href="{{ url_for('admin_edit_course', course_id=course.id) }}"
                  class="btn btn-sm btn-outline-warning"
                  title="Edit Course"
                >
                  <i class="fas fa-edit"></i>
                </a>
                <form
                  method="POST"
                  action="{{ url_for('admin_delete_course', course_id=course.id) }}"
                  style="display: inline"
                >
                  <button
                    type="submit"
                    class="btn btn-sm btn-outline-danger"
                    title="Delete Course"
                    onclick="return confirm('Are you sure you want to delete this course? This action cannot be undone.')"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                </form>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="text-center py-5">
      <i class="fas fa-graduation-cap fa-4x text-muted mb-4"></i>
      <h4 class="text-muted">No courses found</h4>
      <p class="text-muted mb-4">
        Start by adding your first course or importing LinkedIn courses.
      </p>
      <div>
        <a
          href="{{ url_for('admin_add_course') }}"
          class="btn btn-primary btn-lg me-2"
        >
          <i class="fas fa-plus"></i> Add First Course
        </a>
        <form
          method="POST"
          action="{{ url_for('admin_populate_linkedin_courses') }}"
          class="d-inline"
        >
          <button type="submit" class="btn btn-info btn-lg">
            <i class="fab fa-linkedin"></i> Import LinkedIn Courses
          </button>
        </form>
      </div>
    </div>
    {% endif %}
  </div>
</div>

{% endblock %} {% block scripts %}
<!-- Native JavaScript sorting - no external dependencies -->

<style>
  .stat-card {
    padding: 15px;
    border-left: 4px solid #dee2e6;
  }

  .course-description {
    max-width: 200px;
    word-wrap: break-word;
  }

  .table thead th {
    border-bottom: 2px solid #dee2e6;
    font-weight: 600;
  }

  .badge {
    font-size: 0.75em;
  }

  #coursesTable_length,
  #coursesTable_filter {
    margin-bottom: 1rem;
  }

  .pagination-info {
    margin-top: 1rem;
  }

  .pagination-controls {
    margin-top: 1rem;
  }

  .btn-group .btn {
    border-radius: 0.25rem !important;
    margin-right: 2px;
  }

  .table td {
    vertical-align: middle;
  }

  .badge {
    font-size: 0.75em;
    padding: 0.5em 0.75em;
  }

  /* Enhanced hover effects */
  .table-hover tbody tr:hover {
    background-color: rgba(0, 123, 255, 0.05);
  }

  /* Loading animation */
  .spinner-border {
    width: 3rem;
    height: 3rem;
  }

  /* Professional black header table styling with Steel Blue accents */
  .sortable-table {
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .sortable-table thead {
    background-color: #000000 !important; /* Pure black background */
  }

  .sortable-table th {
    background-color: #000000 !important; /* Ensure black background */
    color: #ffffff !important; /* White text for contrast */
    cursor: pointer;
    position: relative;
    user-select: none;
    transition: all 0.3s ease;
    border-bottom: 2px solid transparent;
    font-weight: 600;
    letter-spacing: 0.025em;
    padding: 1rem 0.75rem;
    border-color: #333333; /* Subtle border between headers */
  }

  /* Professional hover styling with dark gray background */
  .sortable-table th.sortable:hover {
    background-color: #2e2e2e !important; /* Subtle dark gray on hover */
    color: #ffffff !important; /* Maintain white text */
    border-bottom-color: #4682b4; /* Steel blue accent border */
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(70, 130, 180, 0.3); /* Steel blue shadow */
  }

  /* Non-sortable headers maintain black background but no interactive effects */
  .sortable-table th:not(.sortable) {
    background-color: #000000 !important;
    color: #ffffff !important;
  }

  .sortable-table th:not(.sortable):hover {
    background-color: #000000 !important; /* No hover effect for non-sortable */
    transform: none;
    box-shadow: none;
    border-bottom-color: transparent;
  }

  /* Active/sorted column styling with Steel Blue highlight */
  .sortable-table th.sortable.sort-asc,
  .sortable-table th.sortable.sort-desc {
    background-color: #4682b4 !important; /* Steel Blue for active sort */
    color: #ffffff !important; /* White text maintained */
    border-bottom-color: #1e3a52; /* Darker Steel Blue border */
    box-shadow: 0 2px 8px rgba(70, 130, 180, 0.4);
  }

  /* Focus styles for accessibility with Steel Blue accent */
  .sortable-table th.sortable:focus {
    outline: 2px solid #4682b4;
    outline-offset: -2px;
    background-color: #2e2e2e !important;
    color: #ffffff !important;
  }

  /* Enhanced row hover effects to complement the black header */
  .sortable-table tbody tr:hover {
    background-color: rgba(70, 130, 180, 0.05);
    transform: scale(1.001);
    transition: all 0.2s ease;
  }

  /* Professional sorting arrows with ‚ñ≤ ‚ñº indicators */
  .sortable-table th.sortable::after {
    content: "‚Üï"; /* Default unsorted indicator */
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    opacity: 0.6;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    color: #cccccc; /* Light gray for visibility on black background */
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
  }

  /* Hover state for sorting arrows on black background */
  .sortable-table th.sortable:hover::after {
    opacity: 1;
    color: #ffffff; /* White arrows on dark gray hover */
    transform: translateY(-50%) scale(1.1);
  }

  /* Active ascending sort with professional ‚ñ≤ indicator */
  .sortable-table th.sortable.sort-asc::after {
    content: "‚ñ≤"; /* Professional upward triangle */
    opacity: 1;
    color: #ffffff !important; /* White on Steel Blue background */
    font-weight: bold;
    transform: translateY(-50%) scale(1.2);
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }

  /* Active descending sort with professional ‚ñº indicator */
  .sortable-table th.sortable.sort-desc::after {
    content: "‚ñº"; /* Professional downward triangle */
    opacity: 1;
    color: #ffffff !important; /* White on Steel Blue background */
    font-weight: bold;
    transform: translateY(-50%) scale(1.2);
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }

  /* Responsive hover effects for touch devices */
  @media (hover: none) {
    .sortable-table th.sortable:hover {
      transform: none;
      box-shadow: none;
    }

    .sortable-table th.sortable:hover::after {
      transform: translateY(-50%);
    }
  }

  /* High contrast mode support for accessibility */
  @media (prefers-contrast: high) {
    .sortable-table th {
      border: 1px solid #ffffff;
    }

    .sortable-table th.sortable::after {
      color: #ffffff;
      text-shadow: none;
    }
  }

  /* Hide sorting arrows for non-sortable columns */
  .sortable-table th.no-sort::after {
    display: none !important;
  }

  /* Modal enhancements */
  .modal-body ul li {
    margin-bottom: 0.5rem;
  }

  .modal-body kbd {
    background-color: #e9ecef;
    color: #495057;
    padding: 0.2rem 0.4rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
  }

  /* Filter section styling */
  .form-label {
    font-weight: 600;
    color: #495057;
    margin-bottom: 0.5rem;
  }

  /* Stats cards enhancement */
  .stat-card:hover {
    transform: translateY(-2px);
    transition: transform 0.2s ease-in-out;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  /* Additional professional styling enhancements */
  .sortable-table {
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
  }

  .sortable-table thead {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  }

  .sortable-table th {
    font-weight: 600;
    letter-spacing: 0.025em;
    padding: 1rem 0.75rem;
    border-bottom: 1px solid #dee2e6;
  }

  /* Focus styles for accessibility */
  .sortable-table th.sortable:focus {
    outline: 2px solid #667eea;
    outline-offset: -2px;
    background: linear-gradient(
      135deg,
      rgba(102, 126, 234, 0.1) 0%,
      rgba(118, 75, 162, 0.1) 100%
    );
  }

  /* Visual feedback for keyboard navigation */
  .sortable-table th.sortable:focus::after {
    opacity: 1;
    color: #667eea;
  }

  /* Enhanced row hover effects */
  .sortable-table tbody tr:hover {
    background-color: rgba(102, 126, 234, 0.03);
    transform: scale(1.001);
    transition: all 0.2s ease;
  }

  /* Override Bootstrap's table-dark styling to ensure our custom black header */
  .sortable-table.table thead th,
  .sortable-table.table thead td {
    background-color: #000000 !important;
    color: #ffffff !important;
    border-color: #333333 !important;
  }

  /* Ensure proper text contrast and readability */
  .sortable-table thead .sortable {
    color: #ffffff !important;
  }

  .sortable-table thead .sortable:hover {
    color: #ffffff !important;
  }

  .sortable-table thead .sortable.sort-asc,
  .sortable-table thead .sortable.sort-desc {
    color: #ffffff !important;
  }

  /* Additional accessibility improvements */
  .sortable-table th.sortable {
    /* Ensure minimum touch target size for mobile accessibility */
    min-height: 44px;
    min-width: 44px;
  }

  /* Screen reader support for sort state */
  .sortable-table th.sortable[aria-sort="ascending"]::before {
    content: "Sorted ascending: ";
    position: absolute;
    left: -10000px;
    width: 1px;
    height: 1px;
    overflow: hidden;
  }

  .sortable-table th.sortable[aria-sort="descending"]::before {
    content: "Sorted descending: ";
    position: absolute;
    left: -10000px;
    width: 1px;
    height: 1px;
    overflow: hidden;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    console.log(
      "DOM loaded - Native sorting implementation with Unicode arrows"
    );

    // Initialize native table sorting
    initializeNativeSorting();

    // Initialize filters
    initializeFilters();

    function initializeNativeSorting() {
      const table = document.getElementById("coursesTable");
      const tbody = table.querySelector("tbody");
      const headers = table.querySelectorAll("th.sortable");

      console.log("Found sortable headers:", headers.length);

      let currentSort = { column: -1, direction: "asc" };

      // Add click listeners to sortable headers
      headers.forEach((header, index) => {
        header.addEventListener("click", function () {
          const column = parseInt(header.getAttribute("data-column"));
          const type = header.getAttribute("data-type");

          console.log(`Sorting column ${column} (${type})`);

          // Update sort direction
          if (currentSort.column === column) {
            currentSort.direction =
              currentSort.direction === "asc" ? "desc" : "asc";
          } else {
            currentSort.direction = "asc";
          }
          currentSort.column = column;

          // Update visual indicators
          updateSortIndicators(headers, header, currentSort.direction);

          // Sort the table
          sortTable(tbody, column, type, currentSort.direction);
        });
      });

      // Initial sort by Title (column 0)
      if (headers.length > 0) {
        updateSortIndicators(headers, headers[0], "asc");
        sortTable(tbody, 0, "text", "asc");
        currentSort = { column: 0, direction: "asc" };
      }
    }

    function updateSortIndicators(headers, activeHeader, direction) {
      // Clear all sort classes
      headers.forEach((header) => {
        header.classList.remove("sort-asc", "sort-desc");
      });

      // Add sort class to active header
      activeHeader.classList.add(
        direction === "asc" ? "sort-asc" : "sort-desc"
      );
    }

    function sortTable(tbody, columnIndex, dataType, direction) {
      const rows = Array.from(tbody.querySelectorAll("tr"));

      rows.sort((a, b) => {
        const aCell = a.cells[columnIndex];
        const bCell = b.cells[columnIndex];

        let aValue = getCellValue(aCell, dataType);
        let bValue = getCellValue(bCell, dataType);

        let comparison = 0;

        switch (dataType) {
          case "number":
            comparison = aValue - bValue;
            break;
          case "level":
            comparison = getLevelOrder(aValue) - getLevelOrder(bValue);
            break;
          case "date":
            comparison = new Date(aValue) - new Date(bValue);
            break;
          default: // text
            comparison = aValue.localeCompare(bValue, undefined, {
              numeric: true,
            });
        }

        return direction === "asc" ? comparison : -comparison;
      });

      // Clear tbody and append sorted rows
      tbody.innerHTML = "";
      rows.forEach((row) => tbody.appendChild(row));

      console.log(
        `Table sorted by column ${columnIndex} (${dataType}) ${direction}`
      );
    }

    function getCellValue(cell, dataType) {
      let text = cell.textContent.trim();

      switch (dataType) {
        case "number":
          // Extract numbers from text like "50 pts"
          const numberMatch = text.match(/\d+/);
          return numberMatch ? parseInt(numberMatch[0]) : 0;
        case "level":
          // Extract level from badge
          return text;
        case "date":
          // Return date text for parsing
          return text;
        default:
          // For text, get the main text (usually from <strong> tag)
          const strongElement = cell.querySelector("strong");
          return strongElement ? strongElement.textContent.trim() : text;
      }
    }

    function getLevelOrder(level) {
      const levelOrder = {
        Beginner: 1,
        Learner: 2,
        Intermediate: 3,
        Expert: 4,
      };
      return levelOrder[level] || 5;
    }

    function initializeFilters() {
      // Add filter event listeners
      const sourceFilter = document.getElementById("sourceFilter");
      const levelFilter = document.getElementById("levelFilter");
      const urlStatusFilter = document.getElementById("urlStatusFilter");
      const pointsFilter = document.getElementById("pointsFilter");
      const searchFilter = document.getElementById("searchFilter");

      if (sourceFilter) {
        sourceFilter.addEventListener("change", filterTable);
      }

      if (levelFilter) {
        levelFilter.addEventListener("change", filterTable);
      }

      if (urlStatusFilter) {
        urlStatusFilter.addEventListener("change", filterTable);
      }

      if (pointsFilter) {
        pointsFilter.addEventListener("change", filterTable);
      }

      if (searchFilter) {
        searchFilter.addEventListener("input", filterTable);
      }
    }

    // Native filtering function
    function filterTable() {
      const sourceFilter = document
        .getElementById("sourceFilter")
        .value.toLowerCase();
      const levelFilter = document
        .getElementById("levelFilter")
        .value.toLowerCase();
      const urlStatusFilter = document
        .getElementById("urlStatusFilter")
        .value.toLowerCase();
      const pointsFilter = document.getElementById("pointsFilter").value;
      const searchFilter = document
        .getElementById("searchFilter")
        .value.toLowerCase();
      const table = document.getElementById("coursesTable");
      const rows = table.querySelectorAll("tbody tr");

      // Debug logging
      if (urlStatusFilter) {
        console.log(`üîç URL Status Filter: "${urlStatusFilter}"`);
      }

      let visibleCount = 0;
      let urlStatusMatchCount = 0;

      rows.forEach((row, index) => {
        const cells = row.querySelectorAll("td");
        const title = cells[0]?.textContent.toLowerCase() || "";
        const source = cells[1]?.textContent.toLowerCase() || "";
        const level = cells[2]?.textContent.toLowerCase() || "";
        const pointsText = cells[3]?.textContent || "";
        const points = parseInt(pointsText.replace(/[^\d]/g, "")) || 0;
        const description = cells[4]?.textContent.toLowerCase() || "";
        const urlStatusCell = cells[5];
        let urlStatus = "";
        if (urlStatusCell) {
          // Get the text content and clean it up
          const fullText = urlStatusCell.textContent || "";
          // Remove all non-letter characters except spaces, then trim
          urlStatus = fullText
            .replace(/[^\w\s]/g, "")
            .trim()
            .toLowerCase();
          // Handle the specific cases we know about
          if (urlStatus.includes("working") && !urlStatus.includes("not")) {
            urlStatus = "working";
          } else if (
            urlStatus.includes("not") &&
            urlStatus.includes("working")
          ) {
            urlStatus = "not working";
          } else if (urlStatus.includes("broken")) {
            urlStatus = "broken";
          } else if (urlStatus.includes("unchecked")) {
            urlStatus = "unchecked";
          }
        }

        const matchesSource = !sourceFilter || source.includes(sourceFilter);
        const matchesLevel = !levelFilter || level.includes(levelFilter);
        const matchesUrlStatus =
          !urlStatusFilter || urlStatus === urlStatusFilter.toLowerCase();
        const matchesPoints =
          !pointsFilter ||
          (pointsFilter === "0-50" && points >= 0 && points <= 50) ||
          (pointsFilter === "51-100" && points >= 51 && points <= 100) ||
          (pointsFilter === "101+" && points >= 101);
        const matchesSearch =
          !searchFilter ||
          title.includes(searchFilter) ||
          description.includes(searchFilter);

        if (urlStatusFilter && matchesUrlStatus) {
          urlStatusMatchCount++;
        }

        if (
          matchesSource &&
          matchesLevel &&
          matchesUrlStatus &&
          matchesPoints &&
          matchesSearch
        ) {
          row.style.display = "";
          visibleCount++;
        } else {
          row.style.display = "none";
        }
      });

      // Debug summary
      if (urlStatusFilter) {
        console.log(
          `üìä URL Status "${urlStatusFilter}": ${urlStatusMatchCount} matches, ${visibleCount} visible after all filters`
        );
      }
    }

    // Clear filters function
    window.clearFilters = function () {
      document.getElementById("sourceFilter").value = "";
      document.getElementById("levelFilter").value = "";
      document.getElementById("urlStatusFilter").value = "";
      document.getElementById("pointsFilter").value = "";
      document.getElementById("searchFilter").value = "";

      // Reset table display and sorting
      filterTable();
      initializeNativeSorting(); // Re-apply default sorting
    };

    // Native filter functions
    document
      .getElementById("sourceFilter")
      .addEventListener("change", function () {
        filterTable();
      });

    document
      .getElementById("levelFilter")
      .addEventListener("change", function () {
        filterTable();
      });

    document
      .getElementById("pointsFilter")
      .addEventListener("change", function () {
        filterTable();
      });

    // Clear all filters and reset sorting
    window.clearFilters = function () {
      document.getElementById("sourceFilter").value = "";
      document.getElementById("levelFilter").value = "";
      document.getElementById("urlStatusFilter").value = "";
      document.getElementById("pointsFilter").value = "";
      document.getElementById("searchFilter").value = "";

      // Clear all column searches
      table.columns().search("").draw();

      // Remove custom search functions
      $.fn.dataTable.ext.search = [];

      // Reset sorting to default (Title column ascending)
      table.order([[0, "asc"]]).draw();

      console.log("All filters and sorting cleared");
    };

    // Export functions
    window.exportData = function (format) {
      if (format === "csv") {
        var data = table.rows({ search: "applied" }).data().toArray();
        var headers = [
          "Title",
          "Source",
          "Level",
          "Points",
          "Description",
          "Course Link",
          "Created",
        ];

        var csv = headers.join(",") + "\n";

        data.forEach(function (row) {
          var cleanRow = [];

          // Clean title (remove HTML tags)
          var titleElement = row[0];
          var titleStrong = titleElement.querySelector("strong");
          var title = titleStrong
            ? titleStrong.textContent
            : titleElement.textContent;
          cleanRow.push('"' + title.replace(/"/g, '""') + '"');

          // Clean source (extract text from badge)
          var source = row[1].textContent.trim();
          cleanRow.push('"' + source.replace(/"/g, '""') + '"');

          // Clean level (extract text from badge)
          var level = row[2].textContent.trim();
          cleanRow.push('"' + level.replace(/"/g, '""') + '"');

          // Clean points (extract number)
          var points = row[3].textContent.replace(/[^\d]/g, "");
          cleanRow.push('"' + points + '"');

          // Clean description
          var description =
            row[4].textContent ||
            row[4].getAttribute("title") ||
            "No description";
          cleanRow.push('"' + description.replace(/"/g, '""') + '"');

          // Extract course link
          var linkElement = row[0].querySelector("a");
          var courseLink = linkElement ? linkElement.getAttribute("href") : "";
          cleanRow.push('"' + courseLink.replace(/"/g, '""') + '"');

          // Clean date
          var date = row[5].textContent.trim();
          cleanRow.push('"' + date.replace(/"/g, '""') + '"');

          csv += cleanRow.join(",") + "\n";
        });

        var blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        var link = document.createElement("a");
        var url = URL.createObjectURL(blob);
        link.setAttribute("href", url);
        link.setAttribute(
          "download",
          "courses_" + new Date().toISOString().split("T")[0] + ".csv"
        );
        link.style.visibility = "hidden";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
    };

    // Print function
    window.printTable = function () {
      var printWindow = window.open("", "_blank");
      if (!printWindow) {
        alert("Please allow popups for this site to use the print function.");
        return;
      }

      // Get filtered data from current table display
      var tbody = table.querySelector("tbody");
      var rows = Array.from(tbody.querySelectorAll("tr")).filter(
        (row) => row.style.display !== "none"
      );

      var tableHtml = '<table class="table table-striped table-bordered">';
      tableHtml +=
        "<thead><tr><th>Title</th><th>Source</th><th>Level</th><th>Points</th><th>Description</th><th>Created</th></tr></thead>";
      tableHtml += "<tbody>";

      rows.forEach(function (row) {
        var cells = row.querySelectorAll("td");
        if (cells.length >= 6) {
          tableHtml += "<tr>";

          // Title
          var titleElement = cells[0].querySelector("strong") || cells[0];
          tableHtml += "<td>" + titleElement.textContent + "</td>";

          // Source, Level, Points, Description, Date
          tableHtml += "<td>" + cells[1].textContent.trim() + "</td>";
          tableHtml += "<td>" + cells[2].textContent.trim() + "</td>";
          tableHtml +=
            "<td>" + cells[3].textContent.replace(/[^\d]/g, "") + " pts</td>";
          tableHtml +=
            "<td>" + (cells[4].textContent || "No description") + "</td>";
          tableHtml += "<td>" + cells[5].textContent.trim() + "</td>";
          tableHtml += "</tr>";
        }
      });

      tableHtml += "</tbody></table>";

      printWindow.document.write(`
              <html>
              <head>
                  <title>Courses Report</title>
                  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
                  <style>
                      body { font-family: Arial, sans-serif; margin: 20px; }
                      h1 { color: #333; margin-bottom: 20px; }
                      .table { font-size: 12px; }
                      @media print {
                          body { margin: 0; }
                          h1 { margin-bottom: 10px; }
                      }
                  </style>
              </head>
              <body>
                  <h1>Course Catalog Report</h1>
                  <p>Generated on: ${new Date().toLocaleDateString()}</p>
                  <p>Total courses: ${data.length}</p>
                  ${tableHtml}
              </body>
              </html>
          `);

      printWindow.document.close();

      // Wait for content to load before printing
      setTimeout(function () {
        printWindow.focus();
        printWindow.print();
      }, 500);
    };

    // Show detailed statistics
    window.showTableStats = function () {
      var tbody = table.querySelector("tbody");
      var visibleRows = Array.from(tbody.querySelectorAll("tr")).filter(
        (row) => row.style.display !== "none"
      );

      // Calculate statistics
      var totalPoints = 0;
      var levelCounts = {};
      var sourceCounts = {};

      visibleRows.forEach(function (row) {
        var cells = row.querySelectorAll("td");
        if (cells.length >= 6) {
          var pointsText = cells[3].textContent.match(/\d+/);
          var points = pointsText ? parseInt(pointsText[0]) : 0;
          totalPoints += points;

          var level = cells[2].textContent.trim();
          var source = cells[1].textContent.trim();

          levelCounts[level] = (levelCounts[level] || 0) + 1;
          sourceCounts[source] = (sourceCounts[source] || 0) + 1;
        }
      });

      var avgPoints =
        visibleRows.length > 0
          ? (totalPoints / visibleRows.length).toFixed(1)
          : 0;

      var statsHtml = `
              <div class="row">
                  <div class="col-md-6">
                      <h6>General Statistics</h6>
                      <ul class="list-unstyled">
                          <li><strong>Filtered Courses:</strong> ${
                            info.recordsDisplay
                          }</li>
                          <li><strong>Total Points:</strong> ${totalPoints}</li>
                          <li><strong>Average Points:</strong> ${avgPoints}</li>
                      </ul>
                  </div>
                  <div class="col-md-6">
                      <h6>Level Distribution</h6>
                      <ul class="list-unstyled">
                          ${Object.entries(levelCounts)
                            .map(
                              ([level, count]) =>
                                `<li><strong>${level}:</strong> ${count}</li>`
                            )
                            .join("")}
                      </ul>
                  </div>
              </div>
              <div class="row mt-3">
                  <div class="col-md-12">
                      <h6>Source Distribution</h6>
                      <ul class="list-unstyled">
                          ${Object.entries(sourceCounts)
                            .map(
                              ([source, count]) =>
                                `<li><strong>${source}:</strong> ${count}</li>`
                            )
                            .join("")}
                      </ul>
                  </div>
              </div>
          `;

      // Create modal or alert with stats
      var modal = document.createElement("div");
      modal.innerHTML = `
              <div class="modal fade" id="statsModal" tabindex="-1">
                  <div class="modal-dialog">
                      <div class="modal-content">
                          <div class="modal-header">
                              <h5 class="modal-title">Course Statistics</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                          </div>
                          <div class="modal-body">
                              ${statsHtml}
                          </div>
                          <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                          </div>
                      </div>
                  </div>
              </div>
          `;
      document.body.appendChild(modal);

      var bootstrapModal = new bootstrap.Modal(
        document.getElementById("statsModal")
      );
      bootstrapModal.show();

      // Clean up modal after hiding
      document
        .getElementById("statsModal")
        .addEventListener("hidden.bs.modal", function () {
          document.body.removeChild(modal);
        });
    };

    // Keyboard shortcuts
    document.addEventListener("keydown", function (e) {
      // Ctrl+E for Export
      if (e.ctrlKey && e.key === "e") {
        e.preventDefault();
        exportData("csv");
      }
      // Ctrl+P for Print
      if (e.ctrlKey && e.key === "p") {
        e.preventDefault();
        printTable();
      }
      // Ctrl+R for Clear Filters
      if (e.ctrlKey && e.key === "r") {
        e.preventDefault();
        clearFilters();
      }
      // Ctrl+S for Stats
      if (e.ctrlKey && e.key === "s") {
        e.preventDefault();
        showTableStats();
      }
    });

    // Show help modal
    window.showHelp = function () {
      var helpHtml = `
              <div class="row">
                  <div class="col-md-12">
                      <h6><i class="fas fa-keyboard"></i> Keyboard Shortcuts</h6>
                      <ul class="list-unstyled">
                          <li><kbd>Ctrl + E</kbd> - Export to CSV</li>
                          <li><kbd>Ctrl + P</kbd> - Print table</li>
                          <li><kbd>Ctrl + R</kbd> - Clear all filters</li>
                          <li><kbd>Ctrl + S</kbd> - Show statistics</li>
                      </ul>
                      <hr>
                      <h6><i class="fas fa-sort"></i> Admin Sorting Features</h6>
                      <ul class="list-unstyled">
                          <li><strong>Column Sorting:</strong> Click any column header to sort</li>
                          <li><strong>Visual Indicators:</strong> 
                              <ul class="mt-2">
                                  <li><i class="fas fa-sort text-muted"></i> Sortable column (default)</li>
                                  <li><i class="fas fa-sort-up text-primary"></i> Sorted ascending</li>
                                  <li><i class="fas fa-sort-down text-primary"></i> Sorted descending</li>
                              </ul>
                          </li>
                          <li><strong>Sort Direction:</strong> Click same header to reverse order</li>
                          <li><strong>Multi-level Sorting:</strong> Available on all columns except Actions</li>
                      </ul>
                      <hr>
                      <h6><i class="fas fa-table"></i> Table Features</h6>
                      <ul class="list-unstyled">
                          <li><strong>Filtering:</strong> Use the search box or dropdown filters</li>
                          <li><strong>Pagination:</strong> Navigate through pages at the bottom</li>
                          <li><strong>Export:</strong> Download filtered results as CSV</li>
                          <li><strong>Print:</strong> Print current view with clean formatting</li>
                          <li><strong>Statistics:</strong> View detailed analytics of current data</li>
                      </ul>
                      <hr>
                      <h6><i class="fas fa-lightbulb"></i> Pro Tips</h6>
                      <ul class="list-unstyled">
                          <li>‚Ä¢ Combine sorting and filtering for precise results</li>
                          <li>‚Ä¢ Hover over column headers to see sorting options</li>
                          <li>‚Ä¢ Use "Clear Filters" to reset all filters and sorting</li>
                          <li>‚Ä¢ Export and statistics reflect current filtered/sorted view</li>
                          <li>‚Ä¢ Level sorting: Beginner ‚Üí Learner ‚Üí Intermediate ‚Üí Expert</li>
                          <li>‚Ä¢ Points sorting: Numerical order (0 ‚Üí highest)</li>
                      </ul>
                  </div>
              </div>
          `;

      var modal = document.createElement("div");
      modal.innerHTML = `
              <div class="modal fade" id="helpModal" tabindex="-1">
                  <div class="modal-dialog modal-lg">
                      <div class="modal-content">
                          <div class="modal-header">
                              <h5 class="modal-title"><i class="fas fa-question-circle"></i> Course Management Help</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                          </div>
                          <div class="modal-body">
                              ${helpHtml}
                          </div>
                          <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                          </div>
                      </div>
                  </div>
              </div>
          `;
      document.body.appendChild(modal);

      var bootstrapModal = new bootstrap.Modal(
        document.getElementById("helpModal")
      );
      bootstrapModal.show();

      // Clean up modal after hiding
      document
        .getElementById("helpModal")
        .addEventListener("hidden.bs.modal", function () {
          document.body.removeChild(modal);
        });
    };

    // Keyboard shortcuts
    document.addEventListener("keydown", function (e) {
      if (e.ctrlKey) {
        switch (e.key) {
          case "e":
            e.preventDefault();
            exportData("csv");
            break;
          case "p":
            e.preventDefault();
            printTable();
            break;
          case "r":
            e.preventDefault();
            clearFilters();
            break;
          case "s":
            e.preventDefault();
            showTableStats();
            break;
        }
      }
    });
  }); // End of DOMContentLoaded

  // Export data function
  function exportData(format) {
    const table = document.getElementById("coursesTable");
    if (!table) return;

    let csv = [];
    const headers = Array.from(table.querySelectorAll("thead th"))
      .map((th) => th.textContent.trim())
      .filter((h) => h !== "Actions");
    csv.push(headers.join(","));

    const rows = table.querySelectorAll('tbody tr:not([style*="none"])');
    rows.forEach((row) => {
      const cells = Array.from(row.querySelectorAll("td")).slice(0, -1);
      const rowData = cells.map((cell) => {
        let text = cell.textContent.trim().replace(/\s+/g, " ");
        if (text.includes(",")) text = `"${text}"`;
        return text;
      });
      csv.push(rowData.join(","));
    });

    const blob = new Blob([csv.join("\n")], { type: "text/csv" });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "courses_export.csv";
    a.click();
    window.URL.revokeObjectURL(url);
  }

  // Print table function
  function printTable() {
    const table = document.getElementById("coursesTable");
    if (!table) return;

    const printContents = table.outerHTML;
    const originalContents = document.body.innerHTML;

    document.body.innerHTML =
      "<html><head><title>Courses</title><style>table{border-collapse:collapse;width:100%;}th,td{border:1px solid #ddd;padding:8px;text-align:left;}th{background-color:#f2f2f2;}</style></head><body>" +
      printContents +
      "</body></html>";
    window.print();
    document.body.innerHTML = originalContents;
    location.reload();
  }

  // Show table stats function
  function showTableStats() {
    const table = document.getElementById("coursesTable");
    if (!table) return;

    const totalRows = table.querySelectorAll("tbody tr").length;
    const visibleRows = table.querySelectorAll(
      'tbody tr:not([style*="none"])'
    ).length;

    alert(
      `Table Statistics:\nTotal Courses: ${totalRows}\nVisible Courses: ${visibleRows}\nFiltered Out: ${
        totalRows - visibleRows
      }`
    );
  }

  // Show help function
  function showHelp() {
    alert(`Course Management Help:
      
Keyboard Shortcuts:
‚Ä¢ Ctrl+E: Export to CSV
‚Ä¢ Ctrl+P: Print table
‚Ä¢ Ctrl+R: Clear all filters
‚Ä¢ Ctrl+S: Show statistics

Admin Features:
‚Ä¢ Click column headers to sort (ascending/descending)
‚Ä¢ Visual sorting indicators (arrows) show current sort direction
‚Ä¢ Full sorting available on all columns except Actions
‚Ä¢ Use filters to narrow results
‚Ä¢ Export filtered data
‚Ä¢ Print current view

Sorting:
‚Ä¢ ‚Üï Default sortable column
‚Ä¢ ‚Üë Sorted ascending
‚Ä¢ ‚Üì Sorted descending
‚Ä¢ Click header again to reverse sort order`);
  }

  // Clear filters function (fallback for manual filtering)
  function clearFilters() {
    document.getElementById("sourceFilter").value = "";
    document.getElementById("levelFilter").value = "";
    document.getElementById("urlStatusFilter").value = "";
    document.getElementById("pointsFilter").value = "";
    document.getElementById("searchFilter").value = "";

    // Clear filters and reset sorting
    filterTable();

    // Reset to default sorting
    var table = document.getElementById("coursesTable");
    if (table) {
      var headers = table.querySelectorAll("th.sortable");
      headers.forEach(function (header) {
        header.classList.remove("sort-asc", "sort-desc");
        header.classList.add("sort-default");
      });
    }
  }

  // Filter table function
  function filterTable() {
    const sourceFilter = document
      .getElementById("sourceFilter")
      .value.toLowerCase();
    const levelFilter = document
      .getElementById("levelFilter")
      .value.toLowerCase();
    const urlStatusFilter = document
      .getElementById("urlStatusFilter")
      .value.toLowerCase();
    const pointsFilter = document.getElementById("pointsFilter").value;
    const searchFilter = document
      .getElementById("searchFilter")
      .value.toLowerCase();
    const table = document.getElementById("coursesTable");
    const rows = table.querySelectorAll("tbody tr");

    rows.forEach((row) => {
      const cells = row.querySelectorAll("td");
      const title = cells[0]?.textContent.toLowerCase() || "";
      const source = cells[1]?.textContent.toLowerCase() || "";
      const level = cells[2]?.textContent.toLowerCase() || "";
      const pointsText = cells[3]?.textContent || "";
      const points = parseInt(pointsText.replace(/[^\d]/g, "")) || 0;
      const description = cells[4]?.textContent.toLowerCase() || "";
      const urlStatusCell = cells[5];
      let urlStatus = "";
      if (urlStatusCell) {
        // Get the text content and clean it up
        const fullText = urlStatusCell.textContent || "";
        // Remove all non-letter characters except spaces, then trim
        urlStatus = fullText
          .replace(/[^\w\s]/g, "")
          .trim()
          .toLowerCase();
        // Handle the specific cases we know about
        if (urlStatus.includes("working") && !urlStatus.includes("not")) {
          urlStatus = "working";
        } else if (urlStatus.includes("not") && urlStatus.includes("working")) {
          urlStatus = "not working";
        } else if (urlStatus.includes("broken")) {
          urlStatus = "broken";
        } else if (urlStatus.includes("unchecked")) {
          urlStatus = "unchecked";
        }
      }

      const matchesSource = !sourceFilter || source.includes(sourceFilter);
      const matchesLevel = !levelFilter || level.includes(levelFilter);
      const matchesUrlStatus =
        !urlStatusFilter || urlStatus === urlStatusFilter.toLowerCase();
      const matchesPoints =
        !pointsFilter ||
        (pointsFilter === "0-50" && points >= 0 && points <= 50) ||
        (pointsFilter === "51-100" && points >= 51 && points <= 100) ||
        (pointsFilter === "101+" && points >= 101);
      const matchesSearch =
        !searchFilter ||
        title.includes(searchFilter) ||
        description.includes(searchFilter);

      if (
        matchesSource &&
        matchesLevel &&
        matchesUrlStatus &&
        matchesPoints &&
        matchesSearch
      ) {
        row.style.display = "";
      } else {
        row.style.display = "none";
      }
    });
  }

  // URL Validation functionality
  let validationInProgress = false;
  let validationStatusInterval = null;

  function startUrlValidation() {
    if (validationInProgress) {
      alert(
        "URL validation is already in progress. Please wait for it to complete."
      );
      return;
    }

    if (
      !confirm(
        "This will validate all course URLs. This may take several minutes. Continue?"
      )
    ) {
      return;
    }

    validationInProgress = true;
    const btn = document.getElementById("validate-urls-btn");
    const originalHtml = btn.innerHTML;

    // Update button to show loading state
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Validating...';
    btn.disabled = true;
    btn.classList.remove("btn-outline-warning");
    btn.classList.add("btn-warning");

    // Show validation notification
    showValidationNotification(
      "URL validation started in background. Results will be updated automatically.",
      "info"
    );

    // Start the validation
    fetch("/admin/validate-all-urls", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.success) {
          // Start checking validation status
          validationStatusInterval = setInterval(checkValidationStatus, 3000); // Check every 3 seconds
        } else {
          throw new Error(data.error || "Failed to start validation");
        }
      })
      .catch((error) => {
        console.error("Error starting validation:", error);
        showValidationNotification(
          "Failed to start URL validation: " + error.message,
          "error"
        );
        resetValidationButton(btn, originalHtml);
      });
  }

  function checkValidationStatus() {
    fetch("/admin/url-validation-status")
      .then((response) => response.json())
      .then((data) => {
        if (data.error) {
          throw new Error(data.error);
        }

        // Update the page with recent validation results
        updateValidationResults(data);

        // Check if validation is complete (you might need to implement a completion indicator)
        // For now, we'll stop checking after 2 minutes
        if (Date.now() - validationStartTime > 120000) {
          // 2 minutes
          stopValidationStatusCheck();
        }
      })
      .catch((error) => {
        console.error("Error checking validation status:", error);
        stopValidationStatusCheck();
      });
  }

  let validationStartTime = 0;

  function updateValidationResults(data) {
    // Update any status indicators on the page
    if (data.recent_updates && data.recent_updates.length > 0) {
      console.log("Recent validation updates:", data.recent_updates);

      // Update table rows with new status
      data.recent_updates.forEach((update) => {
        const row = document.querySelector(`tr[data-course-id="${update.id}"]`);
        if (row) {
          const statusCell = row.querySelector(".url-status");
          if (statusCell) {
            statusCell.textContent = update.status;
            statusCell.className =
              "url-status badge " + getStatusBadgeClass(update.status);
          }
        }
      });

      // Show a brief notification about updates
      const updateCount = data.recent_updates.length;
      showValidationNotification(
        `${updateCount} URL(s) validated`,
        "success",
        3000
      );
    }
  }

  function getStatusBadgeClass(status) {
    switch (status?.toLowerCase()) {
      case "working":
        return "badge-success";
      case "not working":
        return "badge-danger";
      case "broken":
        return "badge-warning";
      default:
        return "badge-secondary";
    }
  }

  function stopValidationStatusCheck() {
    if (validationStatusInterval) {
      clearInterval(validationStatusInterval);
      validationStatusInterval = null;
    }

    const btn = document.getElementById("validate-urls-btn");
    resetValidationButton(
      btn,
      '<i class="fas fa-check-circle"></i> Validate All URLs'
    );

    showValidationNotification("URL validation completed!", "success", 5000);
  }

  function resetValidationButton(btn, originalHtml) {
    validationInProgress = false;
    btn.innerHTML = originalHtml;
    btn.disabled = false;
    btn.classList.remove("btn-warning");
    btn.classList.add("btn-outline-warning");
  }

  function showValidationNotification(message, type, duration = 5000) {
    // Create or update notification
    let notification = document.getElementById("validation-notification");
    if (!notification) {
      notification = document.createElement("div");
      notification.id = "validation-notification";
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1050;
        max-width: 350px;
        padding: 15px;
        border-radius: 5px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      `;
      document.body.appendChild(notification);
    }

    // Set notification style based on type
    const typeStyles = {
      info: "background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb;",
      success:
        "background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb;",
      error:
        "background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;",
    };

    notification.style.cssText += typeStyles[type] || typeStyles.info;
    notification.innerHTML = `
      <strong>${
        type === "error" ? "Error" : type === "success" ? "Success" : "Info"
      }:</strong> ${message}
      <button type="button" style="float: right; background: none; border: none; font-size: 18px; cursor: pointer;" onclick="this.parentElement.remove()">&times;</button>
    `;

    // Auto-remove notification
    if (duration > 0) {
      setTimeout(() => {
        if (notification && notification.parentElement) {
          notification.remove();
        }
      }, duration);
    }
  }

  // Initialize validation start time when validation starts
  document.addEventListener("DOMContentLoaded", function () {
    const validateBtn = document.getElementById("validate-urls-btn");
    if (validateBtn) {
      validateBtn.addEventListener("click", function () {
        validationStartTime = Date.now();
      });
    }
  });
</script>
{% endblock %}
